{"version":3,"sources":["../../app/log/log.model.js"],"names":["LogModel","TIMESTAMP","Date","USERNAME","THREAD","process","pid","IP","REQ_ID","REQ_METHOD","REQ_URI","REQ_HEADERS","REQ_PARAMS","REQ_BODY","RES_STATUS","RES_BODY","RES_TIME","req","get","originalUrl","reqId","reqDate","headers","connection","remoteAddress","method","isEmpty","body","JSON","stringify","params","res","httpCode","format"],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;;;;;IAEaA,Q,WAAAA,Q;AACX,sBAAe;AAAA;;AACb,SAAKC,SAAL,GAAiB,IAAIC,IAAJ,EAAjB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,MAAL,GAAcC,QAAQC,GAAtB;AACA,SAAKC,EAAL,GAAU,EAAV;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACD;;;;+BAEWC,G,EAAK;AACf,WAAKd,QAAL,GAAgBc,IAAIC,GAAJ,CAAQ,cAAR,IAA0BD,IAAIC,GAAJ,CAAQ,cAAR,CAA1B,GAAoD,EAApE;AACA,WAAKR,OAAL,GAAeO,IAAIE,WAAnB;AACA,WAAKX,MAAL,GAAcS,IAAIG,KAAlB;AACA,WAAKnB,SAAL,GAAiBgB,IAAII,OAArB;AACA,WAAKd,EAAL,GAAUU,IAAIK,OAAJ,CAAY,iBAAZ,KAAkCL,IAAIM,UAAJ,CAAeC,aAA3D;AACA,WAAKf,UAAL,GAAkBQ,IAAIQ,MAAtB;AACA,WAAKZ,QAAL,GAAgB,iBAAEa,OAAF,CAAUT,IAAIU,IAAd,IAAsB,EAAtB,GAA2BC,KAAKC,SAAL,CAAeZ,IAAIU,IAAnB,CAA3C;AACA,WAAKhB,WAAL,GAAmBiB,KAAKC,SAAL,CAAeZ,IAAIK,OAAnB,CAAnB;AACA,WAAKV,UAAL,GAAkB,iBAAEc,OAAF,CAAUT,IAAIa,MAAd,IAAwB,EAAxB,GAA6BF,KAAKC,SAAL,CAAeZ,IAAIa,MAAnB,CAA/C;AACD;;;gCAEYC,G,EAAK;AAChB,WAAKhB,QAAL,GAAgBa,KAAKC,SAAL,CAAeE,GAAf,CAAhB;AACA,WAAKjB,UAAL,GAAkBiB,IAAIC,QAAtB;AACA,WAAKhB,QAAL,GAAgB,IAAId,IAAJ,KAAa,KAAKD,SAAlC;AACD;;;mCAEe;AACd,aAAO,sBAAO,KAAKA,SAAZ,EAAuBgC,MAAvB,CAA8B,yBAA9B,IAA2D,GAA3D,GACL,KAAK9B,QADA,GACW,GADX,GAEL,KAAKC,MAFA,GAES,GAFT,GAGL,KAAKG,EAHA,GAGK,GAHL,GAIL,KAAKC,MAJA,GAIS,GAJT,GAKL,KAAKC,UALA,GAKa,GALb,GAML,KAAKC,OANA,GAMU,GANV,GAOL,KAAKC,WAPA,GAOc,GAPd,GAQL,KAAKC,UARA,GAQa,GARb,GASL,KAAKC,QATP;AAUD;;;iCAEa;AACZ,aAAO,sBAAO,KAAKZ,SAAZ,EAAuBgC,MAAvB,CAA8B,yBAA9B,IAA2D,GAA3D,GACL,KAAK9B,QADA,GACW,GADX,GAEL,KAAKC,MAFA,GAES,GAFT,GAGL,KAAKG,EAHA,GAGK,GAHL,GAIL,KAAKC,MAJA,GAIS,GAJT,GAKL,KAAKC,UALA,GAKa,GALb,GAML,KAAKC,OANA,GAMU,GANV,GAOL,KAAKC,WAPA,GAOc,GAPd,GAQL,KAAKC,UARA,GAQa,GARb,GASL,KAAKC,QATA,GASW,GATX,GAUL,KAAKC,UAVA,GAUa,GAVb,GAWL,KAAKC,QAXA,GAWW,GAXX,GAYL,KAAKC,QAZP;AAaD","file":"log.model.js","sourcesContent":["import moment from 'moment'\nimport _ from 'lodash'\n\nexport class LogModel {\n  constructor () {\n    this.TIMESTAMP = new Date();\n    this.USERNAME = '';\n    this.THREAD = process.pid;\n    this.IP = '';\n    this.REQ_ID = '';\n    this.REQ_METHOD = '';\n    this.REQ_URI = '';\n    this.REQ_HEADERS = '';\n    this.REQ_PARAMS = '';\n    this.REQ_BODY = '';\n    this.RES_STATUS = '';\n    this.RES_BODY = '';\n    this.RES_TIME = ''\n  }\n\n  setRequest (req) {\n    this.USERNAME = req.get('dc-user-name') ? req.get('dc-user-name') : '';\n    this.REQ_URI = req.originalUrl;\n    this.REQ_ID = req.reqId;\n    this.TIMESTAMP = req.reqDate;\n    this.IP = req.headers['x-forwarded-for'] || req.connection.remoteAddress;\n    this.REQ_METHOD = req.method;\n    this.REQ_BODY = _.isEmpty(req.body) ? '' : JSON.stringify(req.body);\n    this.REQ_HEADERS = JSON.stringify(req.headers);\n    this.REQ_PARAMS = _.isEmpty(req.params) ? '' : JSON.stringify(req.params)\n  }\n\n  setResponse (res) {\n    this.RES_BODY = JSON.stringify(res);\n    this.RES_STATUS = res.httpCode;\n    this.RES_TIME = new Date() - this.TIMESTAMP\n  }\n\n  getAccessLog () {\n    return moment(this.TIMESTAMP).format('YYYY-MM-DD HH:mm:ss.SSS') + '|' +\n      this.USERNAME + '|' +\n      this.THREAD + '|' +\n      this.IP + '|' +\n      this.REQ_ID + '|' +\n      this.REQ_METHOD + '|' +\n      this.REQ_URI + '|' +\n      this.REQ_HEADERS + '|' +\n      this.REQ_PARAMS + '|' +\n      this.REQ_BODY\n  }\n\n  getInfoLog () {\n    return moment(this.TIMESTAMP).format('YYYY-MM-DD HH:mm:ss.SSS') + '|' +\n      this.USERNAME + '|' +\n      this.THREAD + '|' +\n      this.IP + '|' +\n      this.REQ_ID + '|' +\n      this.REQ_METHOD + '|' +\n      this.REQ_URI + '|' +\n      this.REQ_HEADERS + '|' +\n      this.REQ_PARAMS + '|' +\n      this.REQ_BODY + '|' +\n      this.RES_STATUS + '|' +\n      this.RES_BODY + '|' +\n      this.RES_TIME\n  }\n}\n"]}